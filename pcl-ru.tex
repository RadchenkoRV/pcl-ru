\documentclass{book}

%\overfullrule=4bp

\usepackage{url}
\newcommand{\pclURL}[2]{\href{#1}{#2}\footnote{\href{#1}{#1.}}}

\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{fancyvrb}
\usepackage[dvips]{color}
\usepackage{stmaryrd}
\usepackage{tabularx,mdwtab}
%\usepackage{needspace}
\usepackage{indentfirst}
\usepackage{longtable,citehack,enumerate}
\usepackage{marginnote}
\usepackage{array}
\usepackage{ifmtarg}
\usepackage{centernot}
\usepackage{empheq}
\usepackage{needspace}
\usepackage{colonequals}
\usepackage[nottoc]{tocbibind}
\usepackage{emptypage}

\usepackage{makeidx}
\makeindex

%\usepackage{fancybox}
%% Я хотел использовать fancybox ради \ovalbox, но он определяет свой
%% собственный Verbatim, который конфликтует с fancyvrb.
%% В конце концов нужно будет либо выдернуть оттуда определение
%% \ovalbox, либо отказаться от fancyvrb. Пока что я просто не делаю
%% круглых углов.
\newcommand{\ovalbox}[1]{\fbox{#1}}

%\usepackage[unicode,colorlinks=true]{hyperref}
\usepackage[unicode,]{hyperref}
%\usepackage{hyperref}
%\definecolor{pfpcolorint}{rgb}{0,0.4,0}
%\definecolor{pfpcolorext}{rgb}{0,0,0.6}
%\definecolor{pfpcolorint}{gray}{0.9}
%\definecolor{pfpcolorext}{gray}{0.9}

\hypersetup{%colorlinks,
%	linkcolor=pfpcolorint,
%	citecolor=pfpcolorint,
%	filecolor=pfpcolorext,
%	urlcolor=pfpcolorext,
	bookmarksopen,bookmarksopenlevel=0,
	pdffitwindow,
        colorlinks=false,
        pdfborder={0 0 0},
	% pdfsubject={},
	% pdfkeywords={}
	pdftitle={Practical Common Lisp}
}

\usepackage{epigraph}

\beforeepigraphskip 0pt plus 1fill

% 70х100/16 -> 170mmх240mm
 \usepackage[papersize={160mm,220mm},asymmetric,% bindingoffset=5mm,
hmargin={1cm,1cm},vmargin={1cm,1cm},includehead,ignorefoot,heightrounded,headsep=12bp,headheight=12.5bp,footnotesep=10bp plus2bp minus2bp]{geometry}

% headers & footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[RE]{\nouppercase{\rightmark{}}}
\fancyhead[LO]{\nouppercase{\leftmark{}}}
\fancyhead[LE,RO]{\thepage{}}
\fancyfoot{}

\usepackage{graphicx}

\usepackage[round]{natbib}
\bibliographystyle{plainnat}
\renewcommand{\cite}{\citep} % ???? citep*
\newcommand{\citeterse}{\citep}
\newcommand{\citeyr}[1]{(\citeyear{#1})}
\newcommand{\citeyropen}[1]{\citeyear{#1}}
\newcommand{\longcite}[1]{\citeauthor{#1} \citeyearpar{#1}}
\newcommand{\fulllongcite}[1]{\citeauthor*{#1} \citeyearpar{#1}}
\newcommand{\citeopen}[1]{\citealp{#1}} % citealp*
\newcommand{\citeopenterse}[1]{\citealp{#1}}

\usepackage{bold-extra}
\usepackage{listings}
\definecolor{listingcomment}{gray}{0.3}
\lstset{%
  language=lisp,
  basicstyle=\footnotesize\upshape,%\ttfamily,
  keywordstyle=\bfseries,
  showtabs=false, 
  showspaces=false, 
  showstringspaces=false,% OK?
  tabsize=2,
  commentstyle=\color{listingcomment},
  extendedchars=\true{},
  mathescape=\true{},% allows to use math symbols in listings - may be
                     % dangerous
  basewidth={.5em,.5em},% columns=fullflexible
  xleftmargin=.943em,
  morekeywords={IF, LET, QUOTE, EQ, EQL, EQUAL, EQUALP, NIL, T, FORMAT, if, LOAD, DOLIST,
    PRINT, LIST, DEFUN}
}
\lstdefinestyle{lisp}{language=Lisp,keywordstyle=\bfseries}

\usepackage{parskip}
\setlength{\parskip}{0.0pt plus 1.0pt}
\setlength{\parindent}{15pt}

\usepackage{alltt}
\newenvironment{myverb}[0]{\setlength{\topsep}{-\parskip}\setlength{\partopsep}{4pt}\begin{alltt}\setlength{\leftskip}{20pt}\footnotesize}{\end{alltt}}
\newcommand\bslash{\symbol{`\\}}

\lstdefinestyle{lisprepl}{keywords={}}

\DeclareRobustCommand{\code}[1]{\texttt{\small\texorpdfstring{\def\ldots{...}%
\spaceskip\codespaceskip\relax}{}% \spaceskip3bp plus 1.5bp minus1bp\relax 
#1}}
\def\codespaceskip{\the\spaceskip}

%% proper captions for figures, etc
\usepackage{caption}
\DeclareCaptionLabelSeparator{Period}{.\hskip.5em}
\captionsetup{labelsep=Period,justification=centering}

% Добавляем точку после номера раздела
\usepackage{titlesec}
\titlelabel{\thetitle.\enskip}
\usepackage[dotinlabels]{titletoc}
\titlespacing\section{0pt}{8pt plus 1pt minus 1pt}{5pt plus 1pt minus 1pt}

% settings for floating objects
\renewcommand{\topfraction}{.9}
\renewcommand{\textfraction}{.1}
\renewcommand{\bottomfraction}{.9}
\setcounter{totalnumber}{2}

\fboxsep.25em
\definecolor{gray}{gray}{0.75}
\newcommand{\graybg}[1]{\colorbox{gray}{\mbox{#1}}}

\makeatletter
\newcommand{\translationnotemark}{{\renewcommand{\@makefnmark}{*}\footnotemark{}}}
\newcommand{\translationnotetext}[1]{{\renewcommand{\@makefnmark}{*}\footnotetext{#1 \@Acdash \emph{Прим. перев.}}}\addtocounter{footnote}{-1}}
\newcommand{\translationnote}[1]{\translationnotemark{}\translationnotetext{\hspace{1mm}#1}}
\newcommand{\unmarkednote}[1]{{\renewcommand{\@makefnmark}{}\footnotemark{}\footnotetext{#1}}\addtocounter{footnote}{-1}}
\makeatother

\newcommand\nextpage{\emph{См. след. страницу}}

\newcommand{\textintable}[2]{
  \begin{table}[htb]%
    \centering%
    \begin{longtable}{|p{0.95\textwidth}|}
        \hline
        \multicolumn{1}{|c|}{\textbf{#1}}\\
        \hline
        {\small #2} \\
        \hline
    \end{longtable}%
\end{table}}

\title{Practical Common Lisp}
\author{Peter Seibel}

%\usepackage{sections}

\makeatletter
\renewcommand\@makefnmark{\mbox{\textsuperscript{\normalfont\@thefnmark}\hspace{1mm}}}
\makeatother

\begin{document}
\thispagestyle{empty}
% Don't remove! used for tikz nodes align!
\newlength{\tikztextheight}\settoheight{\tikztextheight}{!}

\VerbatimFootnotes

\selectlanguage{russian}%
\frenchspacing
\righthyphenmin=2

%% TODO: remove...
\sloppy

%\thispagestyle{empty}
%\frontmatter
\thispagestyle{empty}

\makeatletter
\@nameuse{ttl@ps@\string\chapter}
\makeatother

\input{all-chapters}
%\include{chapter-30}

\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
